# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
***Архитектура приложения***
"Онлайн-Ларёк" базируется на классической модели разделения обязанностей в коде: Модель (Model), Представление (View) и Связующее звено (Presenter). Но тут есть важное дополнение — EventDispatcher, который отвечает за общение между частями приложения через события.
Всё происходит так: 
Модель хранит данные.
Представление показывает их на экране.
Презентер соединяет эти два слоя, обрабатывая события и действия пользователя.
EventDispatcher следит за всей этой движухой, чтобы части приложения не запутывались друг в друге.

***Описание архитектурных паттернов***
Архитектура проекта основана на паттерне MVP (Model-View-Presenter) с использованием EventDispatcher как посредника для взаимодействия между компонентами. Этот подход позволяет добиться слабой связанности между слоями приложения и упростить тестирование.

***Model (Модель):***
Отвечает за управление данными и бизнес-логикой.
Предоставляет интерфейс для чтения и изменения данных.
Уведомляет Presenter об изменениях через события EventDispatcher.

***View (Представление):***
Отвечает за отображение данных на экране и обработку пользовательского ввода.
Не содержит бизнес-логики.
Регистрирует события (например, нажатия кнопок) через EventDispatcher.

***Presenter (Презентер):***
Посредник между Model и View.
Получает данные от Model и передаёт их View для отображения.
Обрабатывает события, полученные через EventDispatcher, и инициирует соответствующие изменения в Model.

***EventDispatcher:***
Служит для передачи событий между слоями приложения.
Реализует паттерн "издатель-подписчик" (Publisher-Subscriber), где части приложения подписываются на события и реагируют на них, не обращаясь друг к другу напрямую.
Уведомляет Presenter о событиях в View и Model, обеспечивая их синхронизацию.
Описание взаимодействия частей приложения
Приложение работает следующим образом:

***События в View:***
Пользователь совершает действие (например, нажимает кнопку).
View (например, класс Card) вызывает событие через EventDispatcher, например, card:select, передавая данные о событии.
EventDispatcher уведомляет Presenter:

EventDispatcher вызывает обработчик, на который подписан Presenter.
Presenter принимает событие card:select и данные (например, ID товара), полученные от View.
Обработка в Presenter:

Presenter обрабатывает событие, извлекает или обновляет данные в Model.
Например, если событие связано с добавлением товара в корзину, Presenter вызывает метод addItemToCart в AppStateModel.
Обновления в Model:

Model обновляет свои данные (например, добавляет товар в корзину).
После обновления данных Model инициирует новое событие через EventDispatcher, например, basket:changed.
EventDispatcher уведомляет View:

EventDispatcher уведомляет подписчиков (например, Page), что корзина изменилась.
View обновляет пользовательский интерфейс, отображая новое количество товаров в корзине.

***Пример взаимодействия на основе карточки товара***
Пользователь кликает на карточку товара.

Класс Card вызывает событие card:select, передавая данные о товаре.
EventDispatcher передаёт событие в Presenter.

Presenter обрабатывает событие, извлекает информацию о товаре из Model.
Presenter передаёт данные в View.

Presenter вызывает метод renderModal в классе Modal, передавая данные товара для отображения окна с предпросмотром.
Пользователь добавляет товар в корзину через модальное окно.

Класс Modal вызывает событие product:add.
EventDispatcher уведомляет Presenter, который добавляет товар в корзину через Model.
View обновляет интерфейс корзины.

Model вызывает событие basket:changed.
EventDispatcher уведомляет View (Page), который обновляет количество товаров в корзине.

### Базовый код

***Класс Api — Для работы с HTTP-запросами***
Этот класс помогает нам отправлять запросы к серверу через HTTP (GET, POST, PUT, DELETE). Он подходит для взаимодействия с API и удобен для различных типов запросов. Также можно настраивать параметры и обрабатывать ответы от сервера. Класс Api — это основа для создания других классов, которые могут использовать его и добавлять дополнительные функции под конкретные задачи.

constructor(apiUrl: string, requestParams: RequestInit = {})
apiUrl: URL сервера, с которым будут происходить запросы.
requestParams: Параметры для отправки с запросом (по умолчанию пустые).

***Свойства***
apiUrl: Содержит базовый URL для запросов.
requestParams: Параметры запроса, которые передаются в fetch.
***Методы***
processResponse(response: Response): Обрабатывает ответ от сервера. Если все прошло хорошо, возвращает данные в формате JSON. В противном случае — сообщает об ошибке.
fetchGet(endpoint: string): Отправляет GET-запрос на сервер.
sendRequest(endpoint: string, payload: object, method: HttpMethods = "POST"): Отправляет запрос с любым методом (POST, PUT, DELETE).

***Класс EventDispatcher — Для работы с событиями***
Этот класс нужен для управления событиями внутри приложения. Он как посредник, который организует взаимодействие между разными частями системы через события.

***Свойства***
eventMap: Хранит все события.

constructor()
Инициализирует пустой список для событий.

***Методы***
subscribe(event: string, handler: Function): Подписывает обработчик на событие.
unsubscribe(event: string, handler: Function): Отписывает обработчик от события.
dispatch(event: string, data: any): Вызывает событие и передает ему данные.
subscribeAll(): Подписывает на все события.
unsubscribeAll(): Убирает все подписки.
triggerEvent(event: string, args: any): Создаёт событие с аргументами и вызывает обработчик.

***Класс UIComponent — Для работы с компонентами интерфейса***
Этот класс помогает создавать элементы пользовательского интерфейса. Он используется для взаимодействия с DOM и управления состоянием компонентов, таких как кнопки, блоки, изображения и т.д. Наследуется другими классами, которые представляют элементы интерфейса.

***Свойства***
rootElement: Основной элемент на странице, к которому привязан компонент.

constructor(container: HTMLElement)
Принимает контейнер (например, div), в который будет встроен компонент.

***Методы***
toggleCssClass(element: HTMLElement, className: string): Включает или выключает CSS-класс на элементе.
setTextContent(element: HTMLElement, text: string): Устанавливает текст в элемент.
setElementDisabled(element: HTMLElement, isDisabled: boolean): Отключает или включает элемент.
hideElement(element: HTMLElement): Скрывает элемент.
showElement(element: HTMLElement): Показывает элемент.
setElementImage(element: HTMLElement, src: string, altText?: string): Устанавливает картинку для элемента с текстом альтернативы.
renderComponent(data?: any): Отображает компонент с переданными данными.

***Класс DataModel — Управление данными модели***
Этот класс помогает работать с данными в приложении. Он служит основой для всех моделей данных, уведомляя другие компоненты, когда данные меняются.

***Свойства***
rootElement: Это основной DOM-элемент, с которым связана модель данных.

constructor(data: Partial<T>, eventDispatcher: IEvents)
data: Начальные данные для модели.
eventDispatcher: Объект для управления событиями, который будет уведомлять другие компоненты о изменениях.

***Методы***
notifyChange(event: string, payload?: object): Создаёт событие с переданными данными, чтобы уведомить другие части программы о том, что данные изменились.

***Описание***
DataModel — это класс для работы с данными. Он следит за состоянием данных и уведомляет другие части приложения о том, что они были изменены. Используется для создания моделей, которые отслеживают изменения и могут передавать их другим компонентам.

***Класс WebLarekAPI — Для работы с магазином***
WebLarekAPI расширяет функциональность класса Api и добавляет специальные методы для работы с магазином, такие как получение списка продуктов, подробной информации о товарах и отправка заказов.

***Свойства***
imageBaseURL: Это URL для загрузки изображений продуктов.

constructor(imageBaseURL: string, apiUrl: string, requestParams?: RequestInit)
imageBaseURL: Базовый URL для загрузки изображений.
apiUrl: Базовый URL для API.
requestParams: Параметры для запросов.

***Методы***
fetchProductList(): Получает список всех продуктов с сервера.
fetchProductDetails(id: string): Получает подробную информацию о продукте по его ID.
submitOrder(order: IOrder): Отправляет информацию о заказе и получает результат.

***Описание***
WebLarekAPI — это класс, который добавляет функционал для работы с магазином. Он расширяет базовый функционал Api, позволяя получать информацию о продуктах, их изображениях и отправлять заказы. Этот класс выступает в роли интерфейса между приложением и сервером магазина.

***Компоненты моделей данных***
***Класс ProductModel — Для работы с продуктами***
Этот класс управляет данными о продукте. Он предоставляет структуру для хранения информации, которая будет использоваться как для отображения на сайте, так и для обработки в бизнес-логике. Наследует конструктор от DataModel.

***Свойства***
productId: Уникальный идентификатор продукта.
name: Название продукта.
cost: Цена продукта (может быть неопределена).
details: Описание продукта.
productCategory: Категория продукта.
imageUrl: Ссылка на изображение продукта.
Методы:
Все методы наследуются от DataModel.

***Описание***
ProductModel — это класс, который управляет данными о продукте, такими как его идентификатор, цена, описание и категория. Эти данные могут быть использованы для отображения на сайте или в приложении, а также для выполнения бизнес-логики, связанной с продуктами. Класс использует возможности DataModel для упрощения работы с данными и их обновления.

***Класс AppStateModel — Управление состоянием приложения***
Этот класс управляет основным состоянием приложения, включая каталог продуктов, корзину, заказ и ошибки валидации форм. Он помогает централизованно контролировать и обновлять данные, что упрощает взаимодействие с приложением. Наследует конструктор от DataModel.

***Свойства***
productCatalog: Массив продуктов в каталоге (объекты типа ProductModel).
shoppingCart: Массив продуктов в корзине (объекты типа ProductModel).
orderData: Данные текущего заказа.
productPreview: Идентификатор продукта для предпросмотра (или null).
formValidationErrors: Ошибки валидации формы.

***Методы***
emptyCart(): Очищает корзину и уведомляет об этом событием.
clearOrderData(): Очищает данные о заказе.
updateCatalog(products: IProductData[]): Обновляет каталог продуктов и генерирует событие.
setProductPreview(productId: string | null): Устанавливает продукт для предпросмотра.
addItemToCart(product: ProductModel): Добавляет товар в корзину.
removeItemFromCart(productId: string): Удаляет товар из корзины.
refreshCartState(): Обновляет состояние корзины.
updateDeliveryField(field: string, value: any): Обновляет поле доставки и уведомляет о готовности данных.
updateContactField(field: string, value: any): Обновляет контактные данные и уведомляет о готовности данных.
validateDeliveryFields(): Проверяет правильность данных о доставке.
validateContactFields(): Проверяет правильность контактных данных.

***Описание***
AppStateModel — это центральная модель для управления состоянием приложения. Она хранит и обновляет данные о продуктах, корзине, заказе и ошибках валидации форм. Этот класс предоставляет удобные методы для работы с этими данными и поддерживает согласованность всего приложения.

***Класс Modal — Управление модальным окном***
Этот класс отвечает за создание и управление модальными окнами: открытие, закрытие и изменение содержимого.

constructor(container: HTMLElement, eventDispatcher: IEvents)
container: Контейнер для модального окна.
eventDispatcher: Объект для управления событиями.

***Методы***
setContent(content: string | HTMLElement): Устанавливает содержимое модального окна.
openModal(): Открывает модальное окно и генерирует событие.
closeModal(): Закрывает модальное окно и генерирует событие.
renderModal(data?: IModalWindow): Отображает модальное окно с переданным содержимым и открывает его.

***Описание***
Modal — это класс для управления модальными окнами. Он позволяет открывать и закрывать окна, а также изменять их содержимое, уведомляя другие компоненты о соответствующих событиях.

***Класс Form — Управление формами***
Этот класс управляет созданием форм, обработкой ввода и отправки, а также отображением ошибок валидации и контролем за состоянием формы.

constructor(container: HTMLFormElement, eventDispatcher: IEvents)
container: Контейнер формы.
eventDispatcher: Объект для управления событиями.
***Методы***
handleInputChange(event: Event): Обрабатывает изменения в полях формы и генерирует соответствующие события.
set isValid(isValid: boolean): Управляет активностью кнопки отправки в зависимости от валидности формы.
set validationErrors(errors: FormErrors): Отображает ошибки валидации формы.
renderForm(): Отображает форму, обрабатывает ошибки и устанавливает значения полей.
***Описание***
Form — это класс, который управляет формами в приложении. Он обрабатывает ввод пользователя, проверку данных и отображение ошибок, а также контролирует, доступна ли кнопка отправки формы.

***Класс Page — Управление элементами страницы***
Этот класс управляет основными элементами интерфейса страницы, такими как счетчик корзины, каталог продуктов и общая обертка страницы.

***Свойства***
_basketCounter: Элемент для отображения количества товаров в корзине.
_productCatalog: Контейнер для элементов каталога продуктов.
_pageWrapper: Обертка страницы.
_shoppingBasket: Элемент корзины.

constructor(container: HTMLElement, eventDispatcher: IEvents)
container: Контейнер страницы.
eventDispatcher: Объект для управления событиями.

***Методы***
set basketCount(value: number): Обновляет количество товаров в корзине.
set productCatalog(items: HTMLElement[]): Заполняет каталог продуктов.
set pageLocked(isLocked: boolean): Блокирует или разблокирует страницу.

***Описание***
Page — управляет ключевыми элементами страницы, такими как корзина и каталог продуктов, и позволяет блокировать страницу для предотвращения изменений.

***Класс Card — Управление карточкой товара***
Этот класс управляет отображением карточки товара, включая название, описание, цену и изображение.

***Свойства***
_itemIndex: Порядковый номер продукта в корзине.
_productName: Название товара.
_productDescription: Описание товара.
_productCategory: Категория товара.
_productPrice: Цена товара.
_productImage: URL изображения товара.
_actionButton: Кнопка действия на карточке.
_buttonLabel: Текст кнопки действия.

constructor(container: HTMLElement, actions?: IActions)
container: Контейнер для карточки товара.
actions: Дополнительные действия для кнопки.

***Методы***
disablePurchaseButton(): Деактивирует кнопку покупки, если цена не указана.
productId: Получает или устанавливает идентификатор товара.
productName: Получает или устанавливает название товара.
productPrice: Получает или устанавливает цену товара.
productCategory: Получает или устанавливает категорию товара.
set productImage(src: string): Устанавливает изображение товара.
set productDescription(text: string): Устанавливает описание товара.
set actionButtonLabel(label: string): Устанавливает текст на кнопке действия.

***Описание***
Card — класс для отображения карточек товара. Управляет всем, что связано с отображением информации о товаре на странице.

***Класс Basket — Управление корзиной покупок***
Этот класс отвечает за отображение товаров в корзине, управление их выбором и расчет общей стоимости.

***Свойства***
_itemList: Элемент для списка товаров в корзине.
_totalAmount: Элемент для отображения общей стоимости товаров.
_checkoutButton: Кнопка для перехода к оформлению заказа.

constructor(container: HTMLElement, eventDispatcher: IEvents)
container: Контейнер для корзины.
eventDispatcher: Объект для управления событиями.

***Методы***
toggleCheckoutButton(isEnabled: boolean): Включает или выключает кнопку оформления заказа.
set basketItems(items: HTMLElement[]): Устанавливает товары в корзине.
set totalAmount(value: number): Устанавливает и отображает общую стоимость товаров.

***Описание***
Basket — класс для управления корзиной. Он позволяет добавлять товары, рассчитывать общую стоимость и управлять кнопкой оформления заказа.

***Класс SendForm  — Управление формой доставки***
Этот класс управляет формой доставки, включая выбор способа оплаты и ввод адреса доставки.

***Свойства***
_cardPaymentButton: Кнопка выбора оплаты картой.
_cashPaymentButton: Кнопка выбора оплаты наличными.

constructor(container: HTMLFormElement, eventDispatcher: IEvents, actions?: IActions)
container: Контейнер для формы.
eventDispatcher: Объект для управления событиями.

***Методы***
set deliveryAddress(value: string): Устанавливает адрес доставки.
set phoneNumber(value: string): Устанавливает номер телефона.
set emailAddress(value: string): Устанавливает адрес электронной почты.

***Описание***
SendForm  — класс для отображения и управления формой доставки. Позволяет пользователю выбирать способ оплаты и вводить информацию о доставке.



***Класс Success***
Класс Success создан, чтобы показывать сообщение об успешной операции. Например, если пользователь оформил заказ, можно отобразить текст с деталями. Этот класс расширяет возможности UIComponent<ISuccess>.

***Свойства***
_closeButton: Кнопка для закрытия уведомления.
_totalElement: Поле, где показывается информация о сумме списанных денег или других деталях операции.

constructor(container: HTMLElement, actions: ISuccessActions)
Создает нужные элементы интерфейса и добавляет события для работы.

***Методы***
set transactionDetails(details: string)
Этот метод меняет текст внутри _totalElement. С его помощью можно показать стоимость или другие данные о завершенной операции.



***События в приложении***

***Модальные окна:***
modal:open — открыть окно
modal:close — закрыть окно

***Каталог:***
card:select — выбрать карточку товара
items:changed — изменения в списке товаров
preview:changed — обновление окна с превью

***Товары:***
product:add — добавление товара в корзину
product:toggle — переключение состояния товара (например, из корзины в избранное)
product:delete — удаление товара из корзины

***Корзина:***
basket:open — открыть корзину
basket:changed — изменения в корзине (например, добавление товара)
counter:changed — обновление счетчика товаров в корзине

***Заказ:***
order:open — открыть форму доставки
order:submit — отправка формы заказа
/^order\..*:change/ — изменение данных в форме заказа
delivery:ready — форма готова к отправке
formErrors:change — изменение списка ошибок

***Оплата:***
payment:toggle — изменение способа оплаты

***Контакты:***
contact:ready — форма контактов готова к отправке
contacts:submit — отправка формы с контактами
/^contacts\..*:change/ — изменения в контактной форме


***Типы данных***
***Ниже описаны основные типы данных, которые используются в проекте.***

***Типы для базовых функций:***

***Работа с событиями:***
interface IEvents {
    on<T extends object>(event: EventName, callback: (data: T) => void): void; // подписка на событие
    emit<T extends object>(event: string, data?: T): void; // запуск события
    trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void; // обработчик события
}

***Ответы от сервера:***
type ApiListResponse<Type> = {
    total: number; // общая стоимость товаров
    items: Type[]; // список товаров
};

***Методы работы с сервером***
type ApiPostMethods = 'POST' | 'PUT' | 'DELETE';

***Типы данных для компонентов:***

***Статус формы***
interface IFormStatus {
    valid: boolean; // проверка, правильная ли форма
    errors: string[]; // список ошибок, если есть
}

***Данные для модального окна***
interface IModalWindow {
    content: HTMLElement; // HTML-элемент, который будет внутри модального окна
}



***Типы данных***
***Здесь собраны все основные типы данных, которые используются в приложении.***

***Товар***
Каждый товар описывается следующим образом:

interface IProduct {  
    id: string; // уникальный ID товара  
    category: string; // категория, к которой относится товар  
    image: string; // URL изображения товара  
    title: string; // название товара  
    description: string; // описание товара  
    price: number | null; // цена товара  
}

***Состояние приложения***
***Основные данные, которые хранятся в приложении:***
interface IAppState {  
    catalog: IProduct[]; // список всех товаров в каталоге  
    basket: IProduct[]; // товары, добавленные в корзину  
    preview: string | null; // ID товара для детального просмотра  
    order: IOrder | null; // данные о текущем заказе  
}

***Данные для главной страницы***
interface IPage {  
    counter: number; // количество товаров в корзине  
    catalog: HTMLElement[]; // карточки товаров на странице каталога  
}

***Данные доставки***
interface ISendForm {  
    payment: string; // выбранный способ оплаты  
    address: string; // адрес доставки  
}

***Контактная информация***
interface IContactForm {  
    email: string; // электронная почта  
    phone: string; // номер телефона  
}

***Полные данные заказа***
***Эта структура объединяет данные доставки и контактов:***
interface IOrder extends ISendForm, IContactForm {  
    total: number; // общая сумма заказа  
    items: string[]; // ID товаров, включенных в заказ  
}
***Ответ сервера на зака***з
***Данные, которые приходят от сервера после оформления заказа:***
interface IOrderResult {  
    id: string; // ID заказа  
    total: number; // итоговая стоимость заказа  
}

***Ошибки форм***
type FormErrors = Partial<Record<keyof IOrder, string>>; // список ошибок для полей формы 

***Данные карточки товара***
interface ICard extends IProduct {  
    buttonTitle?: string; // текст на кнопке (например, "Купить")  
}

***Данные для корзины***
interface IBasketView {  
    items: HTMLElement[]; // список карточек товаров в корзине  
    total: number; // итоговая стоимость всех товаров  
}


***Успешный заказ***
interface ISuccess {  
    total: number; // итоговая стоимость заказа  
}

***Действия для интерфейса***
***Общие действия, которые можно передать в разные компоненты:***
interface IActions {  
    onClick: (event: MouseEvent) => void; // обработчик клика  
}

***Действия для успешного заказа***
interface ISuccessActions {  
    onClick: () => void; // действие, выполняемое при клике  
}

